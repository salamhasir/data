<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>لوحة الإحصائيات - الإدارة العامة للتعليم</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
  font-family: 'Cairo', sans-serif;
  background-color: #f0f4f8;
  margin: 0;
  padding: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  min-height: 100vh;
}
    header {
      background-color: #004e89;
      color: white;
      text-align: center;
      padding: 20px;
    }
    .container {
  display: flex;
  gap: 20px;
  flex-direction: row;
  flex-wrap: wrap;
  justify-content: space-around;
  align-items: flex-start;
  max-width: 1200px;
  width: 100%;
  background: white;
  border-radius: 10px;
  padding: 20px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  margin-top: 20px;
}
    h2 {
      text-align: center;
      margin-bottom: 20px;
    }
    canvas {
  max-width: 100%;
  margin-bottom: 20px;
}
  @media (max-width: 768px) {
  .container {
    flex-direction: column;
    align-items: center;
  }
}
</style>
</head>
<body>
  <header>
    <h1>الإدارة العامة للتعليم بمنطقة عسير</h1>
    <h3>قسم الأمن والسلامة والمرافق</h3>
  </header>
  <div class="container">
    <h2>📊 لوحة الإحصائيات</h2>
    <label for="sectorSelect">اختر قطاعًا لعرض البيانات:</label>
    <select id="sectorSelect">
      <option value="all">كل القطاعات</option>
    </select>
    <p id="summary"></p>
    <div style="flex: 1; min-width: 300px;"><canvas id="statusChart"></canvas></div>
    <br>
    <div style="flex: 1; min-width: 300px;"><canvas id="sectorChart"></canvas></div>
    <div style="flex: 1; min-width: 300px;"><canvas id="barStatusChart"></canvas></div>
  </div>
  <script>
    const scriptURL = "https://script.google.com/macros/s/AKfycbyEHr9r1KLWmf-vCShIlFU7N_q69ZFws0mTu_3AbY-l1IqJTOvwNQaL2m8IeagGpFgo/exec?action=stats";

    fetch(scriptURL)
      .then(res => res.json())
      .then(data => {
        document.getElementById("summary").textContent = `إجمالي المدارس: ${data.total}, المؤكدة: ${data.confirmed}, المعدلة: ${data.modified}, لم ترد: ${data.pending}`;

        new Chart(document.getElementById("statusChart"), {
          type: 'doughnut',
          data: {
            labels: ['تم التأكيد', 'بيانات غير صحيحة', 'لم يتم الرد'],
            datasets: [{
              data: [data.confirmed, data.modified, data.pending],
              backgroundColor: ['#28a745', '#ffc107', '#dc3545']
            }]
          },
          options: {
            responsive: true,
            plugins: {
              title: {
                display: true,
                text: 'حالة تحديث البيانات'
              }
            }
          }
        });

        const sectors = Object.keys(data.sectors);
        const select = document.getElementById("sectorSelect");
        sectors.forEach(sector => {
          const option = document.createElement("option");
          option.value = sector;
          option.textContent = sector;
          select.appendChild(option);
        });
        const values = Object.values(data.sectors);

        new Chart(document.getElementById("sectorChart"), {
          type: 'bar',
          data: {
            labels: sectors,
            datasets: [{
              label: 'عدد المدارس حسب القطاع',
              data: values,
              backgroundColor: '#007bff'
            }]
          },
          options: {
            responsive: true,
            indexAxis: 'y',
            plugins: {
              title: {
                display: true,
                text: 'توزيع المدارس حسب القطاعات'
              }
            }
          }
        });

        new Chart(document.getElementById("barStatusChart"), {
          type: 'bar',
          data: {
            labels: ['تم التأكيد', 'بيانات غير صحيحة', 'لم يتم الرد'],
            datasets: [{
              label: 'عدد الحالات',
              data: [data.confirmed, data.modified, data.pending],
              backgroundColor: ['#28a745', '#ffc107', '#dc3545']
            }]
          },
          options: {
            responsive: true,
            plugins: {
              title: {
                display: true,
                text: 'مخطط أعمدة لحالة البيانات'
              }
            }
          }
        });
      })
      .catch(err => {
        document.getElementById("summary").textContent = 'تعذر تحميل البيانات. تأكد من الرابط أو الاتصال.';
        console.error('Fetch error:', err);
      });
  </script>
</body>
</html>

